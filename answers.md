×›×™×•×•× ×™ ××—×©×‘×”: 

×‘×“×™×§×” ×× ×¤×¨×•××ª×™×•×¡ ×™×•×“×¢ ×œ×§×‘×œ ××¢×¨×š ×›×¨×©×™××ª ×˜×¨×’×¡×˜ - × ×©×œ×œ ×›×™ ×”×•× ×œ× ×™×•×“×¢ 
×‘×“×™×§×” ×©×œ ×¤×¨×•×™×§×˜ ×’×™×˜ ×‘×©× https://github.com/laixintao/prometheus-http-sd?tab=readme-ov-file#usage ×©×™×•×›×œ ×œ×¢×©×•×ª ×–××ª 
×—×•×¡×¨ ×™×›×•×œ×ª ×œ×”×ª×—×‘×¨ ×œ×–×” ×‘×’×œ×œ ×—×©×‘×•×Ÿ ×“×•×§×¨ 

×¡×§×¨×™×¤×˜ ×¤×™×™×ª×•×Ÿ ×™×“× ×™ ×©×™×¨×•×¥ ×¢×œ ×§×•× ×˜×™×™× ×¨ ×¡×¤×¦×™×¤×™ ×©×œ ×¤×™×™×ª×•×Ÿ, ×™×™×’×© ×›×œ 5 ×©× ×™×•×ª ×œ×¨×©×™××ª ×”×©×¨×ª×™× ×•×™×¢×“×›×Ÿ ××•×ª×” ×‘×•×•×œ×™×•× ×©×”×•× ×§×•×‘×¥ ×’×™×™×¡×•×Ÿ 
×”×¤×¨×•××™×ª×™×•×¡ ×™×¡×ª×›×œ ×’× ×”×•× ×›×œ 5 ×©× ×™×•×ª ×•×™×‘×“×•×§ ×©×™× ×•×™×™× ×‘×§×•×‘×¥ 
×•×›×š ×™×”×™×” ×¡× ×›×¨×•×Ÿ ×‘×™× ×™×”× 
××‘×—×™× ×” ××‘×˜×—×ª×™×ª: 
×”×§×•× ×˜×™×™× ×¨ ×”×™×—×™×“ ×©×™×© ×œ×• ×’×™×©×” ×—×™×¦×•× ×™×ª ×”×•× ×”×¤×¨×•××ª×™×•×¡ ×‘×¤×•×¨×˜ 9090 , ×›×œ ×”×©××¨ ×¢×•×‘×“×™× ×‘×ª×§×©×•×¨×ª ×¤× ×™××™×ª ×‘×™×Ÿ ×§×•× ×˜×™×™× ×¨×™× ×‘×¨×©×ª trigo-net
×¨×¦×™×ª×™ ×’× ×œ×©× ×•×ª ××ª ×”×™×•×–×¨ ×©×¨×¥ ×‘×§×•× ×˜×™×™× ×¨ update_targets ×©×œ× ×™×”×™×” ×¨×•×˜ ××œ× ××©×ª××© ×¢× ×¤×—×•×ª ×”×¨×©××•×ª 

×—×¡×¨×•× ×•×ª ×‘×©×™×˜×” ×©×‘×—×¨×ª×™: 
×§×•× ×˜×™×™× ×¨ ×©×—×™ ×ª××™×“ ×•×¦×•×¨×š ××©××‘×™× ×œ××¨×•×ª ×©×”×•× ×‘×¤×¢×•×œ×” ×¤×¢× ××—×ª ×‘5 ×©× ×™×•×ª ×œ×¡×§×¨×™×¤×˜ ×§×¦×¨ , ×× ×”×™×™×ª×™ ×‘×¡×‘×™×‘×ª ×¢× ×Ÿ ×”×™×™×ª×™ ××©×ª××© ×‘stateless function  ××• ×›×§×¨×•×Ÿ ×’×•×‘ ×‘×¡×‘×™×‘×ª ×§×•×‘×¨× ×˜×™×¡ 

×›×›×œ×œ ×”×™×™×ª×™ ××¢×“×™×£ ×œ×”×¨×™×¥ ××ª ×”×¡×§×¨×™×¤×˜ ×›×§×¨×•×Ÿ ×’×•×‘ ×¢×œ ×”×§×•× ×˜×™×™× ×¨ update targets , ××‘×œ ×‘×’×œ×œ ×ª×§×œ×ª ×”××™× ×˜×¨× ×˜ ×”×©××¨×ª×™ ××ª ×–×” ×¢× sleep ×‘×¡×•×£. 
×”×¡×™×‘×” ×©×”×™×™×ª×™ ××¢×“×™×£ ×§×¨×•×Ÿ ×’×•×‘ ×”×™× × ×•×—×•×ª ×•×§×¨×™××•×ª ×‘×¢×™×§×¨. 

×‘×©×‘×™×œ ×œ×”×¨×™×¥ ××ª ×”×¡×‘×™×‘×” ×™×© ×œ×”×¨×™×¥ docker compose up 
×œ×’×©×ª ×œlocalhost:9090  ×•×œ×¨××•×ª ××ª ×”×¤×¨×•×ª×™×•×¡ 

<div dir="rtl">

<h1>âš™ï¸ ×¡×™×›×•× ×ª×¨×’×™×œ Prometheus ×•Ö¾Python Updater</h1>

<h2>ğŸ§ª ×ª×”×œ×™×š ×”×‘×“×™×§×”</h2>
<ul>
  <li><b>×‘×“×™×§×” ×¨××©×•× ×”:</b> ×”×× Prometheus ×™×•×“×¢ ×œ×§×‘×œ ××¢×¨×š ×˜×¨×’×˜×™× ×™×©×™×¨×•×ª â€” âŒ × ×©×œ×œ (× ×“×¨×© ×¤×•×¨××˜ JSON ×™×™×¢×•×“×™).</li>
  <li><b>×‘×“×™×§×” ×©× ×™×™×”:</b> ×¤×¨×•×™×§×˜ GitHub
    <a href="https://github.com/laixintao/prometheus-http-sd?tab=readme-ov-file#usage">prometheus-http-sd</a>
    â€“ × ×‘×“×§ ×›×¤×ª×¨×•×Ÿ ××¤×©×¨×™, ××š âŒ ×œ× ×”×ª×—×‘×¨ ×‘×©×œ ×‘×¢×™×™×ª ×—×©×‘×•×Ÿ Docker.
  </li>
</ul>

<h2>ğŸ ×”×¡×§×¨×™×¤×˜ ×©×¤×•×ª×—</h2>
<ul>
  <li>×¡×§×¨×™×¤×˜ Python ×‘×§×•× ×˜×™×™× ×¨ ×™×™×¢×•×“×™.</li>
  <li>×›×œ <b>5 ×©× ×™×•×ª</b> × ×™×’×© ×œÖ¾Flask (×¨×©×™××ª ×”×©×¨×ª×™×) ×•××¢×“×›×Ÿ <code>targets.json</code> ×‘× ×¤×— ××©×•×ª×£ (Volume).</li>
  <li>Prometheus ×§×•×¨× ××ª ××•×ª×• ×§×•×‘×¥ ×“×¨×š <code>file_sd_config</code> ×•××¨×¢× ×Ÿ ×’× ×”×•× ×›×œ <b>5 ×©× ×™×•×ª</b>.</li>
</ul>

<h2>ğŸ” ×©×™×§×•×œ×™ ××‘×˜×—×”</h2>
<ul>
  <li>×”×§×•× ×˜×™×™× ×¨ ×”×™×—×™×“ ×©×—×©×•×£ ×”×—×•×¦×”: <b>Prometheus</b> (×¤×•×¨×˜ 9090).</li>
  <li>×©××¨ ×”×§×•× ×˜×™×™× ×¨×™× ××ª×§×©×¨×™× ×¤× ×™××™×ª ×‘×œ×‘×“ ×¢×œ ×¨×©×ª <code>trigo-net</code>.</li>
</ul>

<h2>ğŸ‘¤ ×”×¨×©××•×ª ×•×”×¨×¦×”</h2>
<ul>
  <li>×”×§×•× ×˜×™×™× ×¨ <code>update_targets</code> ×¨×¥ ×›××©×ª××© ×œ×Ö¾root (××™× ×™××•× ×”×¨×©××•×ª).</li>
</ul>

<h2>âš ï¸ ×—×¡×¨×•× ×•×ª</h2>
<ul>
  <li>×§×•× ×˜×™×™× ×¨ ×”Ö¾Updater â€œ×—×™â€ ×ª××™×“, ××£ ×©×”×¤×¢×•×œ×” ×§×¦×¨×” ×•××ª×¨×—×©×ª ×›×œ 5 ×©× ×™×•×ª.</li>
  <li>×‘×¢× ×Ÿ ×”×™×” ×¢×“×™×£ <b>Stateless Function</b> ××• <b>CronJob ×‘×§×•×‘×¨× ×˜×™×¡</b>.</li>
</ul>

<h2>ğŸ§­ ×©×™×§×•×œ×™× ×ª×›× ×•× ×™×™×</h2>
<ul>
  <li>×”×¢×“×¤×” ×œÖ¾<b>CronJob</b> ×œ×§×¨×™××•×ª ×•× ×•×—×•×ª; ×‘×©×œ ×ª×§×œ×ª ××™× ×˜×¨× ×˜ × ×‘×—×¨ ×¤×ª×¨×•×Ÿ <code>sleep</code> ×–×× ×™.</li>
</ul>

<h2>ğŸš€ ×”×¤×¢×œ×”</h2>
<ol>
  <li>×œ×”×¨×™×¥: <code>docker compose up</code></li>
  <li>×œ×’×œ×•×© ×œÖ¾ <code>http://localhost:9090</code></li>
  <li>×‘Ö¾<b>Targets</b> ×œ×•×•×“× ×©×›×œ ×”×™×¢×“×™× ××–×•×”×™×.</li>
</ol>

<h2>ğŸ“š ×¡×™×›×•×</h2>
<ul>
  <li>Prometheus ×›× ×§×•×“×ª × ×™×˜×•×¨ ×™×—×™×“×” ×”×—×©×•×¤×” ×”×—×•×¦×”.</li>
  <li>Updater ××¢×“×›×Ÿ ×“×™× ××™×ª ××ª ×¨×©×™××ª ×”×™×¢×“×™×.</li>
  <li>×¨×©×ª ×¤× ×™××™×ª ××‘×•×“×“×ª (<code>trigo-net</code>), ×•×”×¨×©××•×ª ××¦×•××¦××•×ª.</li>
</ul>

</div>


Dynamic Prometheus Target Updater
Overview

This project provides a dynamic way for Prometheus to discover targets without requiring manual configuration or service discovery integrations.
A lightweight Python container periodically fetches a list of servers and updates a JSON file shared with Prometheus via a Docker volume.
Prometheus is configured to read from this file every 5 seconds, effectively synchronizing its targets dynamically.

Background and Reasoning
Initial Considerations

Prometheus native configuration does not support defining targets as an array dynamically.

Attempted approach: using prometheus-http-sd
 â€” rejected due to Docker authentication issues.

Final Approach

A custom Python script runs inside a dedicated container (update_targets).

Every 5 seconds, it:

Fetches the current server list.

Updates a shared JSON file inside a Docker volume.

Prometheus also reads this file every 5 seconds, detecting any changes automatically.

Security Considerations

The only externally accessible container is Prometheus (port 9090).

All other containers communicate internally via the Docker network trigo-net.

The update_targets container runs as a non-root user to minimize privileges.

Limitations

The Python container runs continuously, consuming minimal but constant resources, even though it only performs work every 5 seconds.

In a cloud or Kubernetes environment, this would ideally run as a stateless function or a CronJob, triggered periodically instead of being persistent.

Design Decision

The current setup uses a sleep loop for simplicity due to connectivity issues.
However, the preferred method would be a cron-based execution for better readability and maintainability.

Usage

Run the environment:

docker compose up


Access Prometheus at:

http://localhost:9090


You should see your dynamically updated targets reflected automatically.